<?xml version="1.0" encoding="UTF-8"?>
<jobs xmlns="http://www.demandware.com/xml/impex/jobs/2015-07-01">

    <job job-id="AlgoliaProductsDeltaIndex_v2" priority="0">
        <description>Send product record index updates to Algolia for B2C Product objects assigned to the site that have changed since the last job run (either via BM or a product feed import, max 7 days).
The job relies on SFCC's built-in Delta Exports feature (needs to be enabled) to calculate the delta, then enriches and transforms the products before sending them to Algolia for indexing.</description>
        <parameters>
            <parameter name="catalogIDs">apparel-catalog, apparel-m-catalog</parameter>
            <parameter name="consumer">algolia</parameter>
            <parameter name="deltaExportJobName">productDeltaExport</parameter>
        </parameters>
        <flow>
            <context site-id="RefArch"/>
            <step step-id="catalogDeltaExport" type="CatalogDeltaExport" enforce-restart="false">
                <description>Standard B2C catalog delta export. The productIDs will be extracted from this export, the products retrieved from the database, enriched and sent to Algolia.</description>
                <parameters>
                    <parameter name="CatalogIDs" job-parameter-ref="catalogIDs"/>
                    <parameter name="Consumers" job-parameter-ref="consumer"/>
                    <parameter name="ExportFile" job-parameter-ref="deltaExportJobName"/>
                    <parameter name="MasterProductExport">true</parameter>
                </parameters>
            </step>
            <step step-id="algoliaIndexDeltaProductUpdates" type="custom.algoliaIndexDeltaProductUpdates" enforce-restart="false">
                <description>Performs delta index updates on your Algolia product records using the B2C Delta Export feature (needs to be enabled).
Extracts the list of productIDs (of changed products) from the B2C Delta Export, retrieves and enriches the products data, then sends them to Algolia.
Can perform full records updates or partial records updates. See the 'indexingMethod' field for details.</description>
                <parameters>
                    <parameter name="consumer" job-parameter-ref="consumer"/>
                    <parameter name="deltaExportJobName" job-parameter-ref="deltaExportJobName"/>
                    <parameter name="indexingMethod">fullRecordUpdate</parameter>
                </parameters>
            </step>
        </flow>
        <rules/>
        <triggers/>
    </job>

    <job job-id="AlgoliaCategoriesIndex_v2" priority="0">
        <description>Reindex all categories (incl. categories structures) assigned to the selected site to Algolia.</description>
        <parameters/>
        <flow>
            <context site-id="RefArch"/>
            <step step-id="algoliaCategoriesIndex" type="custom.algoliaCategoriesIndex" enforce-restart="false">
                <description>Reindex all categories (incl. categories structures) assigned to the selected site to Algolia.</description>
            </step>
        </flow>
        <rules/>
        <triggers/>
    </job>

    <job job-id="AlgoliaProductsIndex_v2" priority="0">
        <description>Index all products assigned to the selected site to Algolia.</description>
        <parameters/>
        <flow>
            <context site-id="RefArch"/>
            <step step-id="algoliaProductsIndex" type="custom.algoliaProductsIndex" enforce-restart="false">
                <description>Index all products assigned to the selected site to Algolia. The list of indexed attributes is configurable, and by default contains related price and inventory data for each product. Can perform partial records updates, full records updates or a full catalog reindex, depending on the 'indexingMethod':
- 'partialRecordUpdate' will only update the specified fields in the index.
- 'fullRecordUpdate' will replace the entire record in the index with the new data.
- 'fullCatalogReindex' will create a temporary Algolia index, reindex all your products catalog in it, and replace the production index at the end.</description>
                <parameters>
                    <parameter name="resourceType">products</parameter>
                    <parameter name="fieldListOverride"/>
                    <parameter name="indexingMethod">fullRecordUpdate</parameter>
                </parameters>
            </step>
        </flow>
        <rules>
            <on-running runtime-threshold="60m" enabled="false">
                <mark-job-as-hanging/>
            </on-running>
        </rules>
        <triggers/>
    </job>

    <job job-id="AlgoliaProductsPricesIndex_v2" priority="0">
        <description>Reindex price data for each product assigned to the current site.
Performs a partial update on the product objects in the Algolia index.</description>
        <parameters/>
        <flow>
            <context site-id="RefArch"/>
            <step step-id="algoliaPricesIndex" type="custom.algoliaProductsIndex" enforce-restart="false">
                <description>Retrieves and sends price data for all products assigned to the current site. Sends partial product updates to Algolia, updating only the "price" property of the product objects in the index by default.</description>
                <parameters>
                    <parameter name="resourceType">price</parameter>
                    <parameter name="fieldListOverride">price</parameter>
                    <parameter name="indexingMethod">partialRecordUpdate</parameter>
                </parameters>
            </step>
        </flow>
        <rules>
            <on-running runtime-threshold="60m" enabled="false">
                <mark-job-as-hanging/>
            </on-running>
        </rules>
        <triggers/>
    </job>

    <job job-id="AlgoliaProductsInventoryIndex_v2" priority="0">
        <description>Reindex inventory data for each product assigned to the current site.
Performs a partial update on the product objects in the Algolia index.</description>
        <parameters/>
        <flow>
            <context site-id="RefArch"/>
            <step step-id="algoliaInventoryIndex" type="custom.algoliaProductsIndex" enforce-restart="false">
                <description>Retrieves and sends inventory data for all products assigned to the current site. Sends partial product updates to Algolia, updating only the "in_stock" property of the product objects in the index by default.</description>
                <parameters>
                    <parameter name="resourceType">inventory</parameter>
                    <parameter name="fieldListOverride">in_stock</parameter>
                    <parameter name="indexingMethod">partialRecordUpdate</parameter>
                </parameters>
            </step>
        </flow>
        <rules>
            <on-running runtime-threshold="60m" enabled="false">
                <mark-job-as-hanging/>
            </on-running>
        </rules>
        <triggers/>
    </job>

</jobs>
